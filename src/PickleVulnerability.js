import React, { useState } from 'react';

function PickleVulnerability() {
  const [payload, setPayload] = useState('');
  const [result, setResult] = useState('');

  const fetchExploit = async () => {
    try {
      const response = await fetch('http://localhost:5001/pickle/generate-exploit');
      const data = await response.json();
      setPayload(data.payload);
    } catch (error) {
      console.error('Error fetching exploit:', error);
      setResult('Error fetching exploit. Is the Python server running?');
    }
  };

  const sendPayload = async () => {
    try {
      const response = await fetch('http://localhost:5001/pickle', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ payload }),
      });
      const text = await response.text();
      setResult(text);
    } catch (error) {
      console.error('Error sending payload:', error);
      setResult('Error sending payload. Is the Python server running?');
    }
  };

  return (
    <div className="card">
      <h2>Insecure Deserialization (Python Pickle)</h2>
      <p>
        This demonstrates a vulnerability where a Python backend unsafely deserializes data using <code>pickle</code>.
        The exploit payload will execute the <code>whoami</code> command on the server.
      </p>
      <button onClick={fetchExploit}>Generate Exploit Payload</button>
      <textarea
        value={payload}
        readOnly
        placeholder="Click 'Generate Exploit Payload' to get a malicious payload."
        style={{ width: '95%', height: '100px', padding: '10px', margin: '10px 0' }}
      />
      <button onClick={sendPayload} disabled={!payload}>
        Send Payload to Vulnerable Endpoint
      </button>
      <div className="output-area">
        <h3>Backend Response:</h3>
        <p>{result}</p>
        <p>
          <strong>Note:</strong> The output of the <code>whoami</code> command will appear in the console of the Python server, not here.
        </p>
      </div>
    </div>
  );
}

export default PickleVulnerability;
